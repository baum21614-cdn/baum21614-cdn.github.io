const userCity = getUserCoordinates(),
    tempe = document.getElementById("cond"),
    cond = document.getElementById("condtd");
function apiPull(reqCity) {
    function displayError(){
        let imgsrc = `https://baum21614-cdn.github.io/imges/weather/undefined.svg`
        document.querySelector(".wepicin").src = imgsrc
        tempe.innerText = "--"
        cond.innerText = "Error"
    }
    let apiKey, api;
    function weatherDetails(inf) {
        const { description: description, id: id, main: main } = inf.weather[0];
        let realTemp = inf.main.temp,
            ic_ced;
        (tempe.innerText = Math.floor(realTemp)),
            (cond.innerText = main),
            800 == id
                ? (ic_ced = "clear")
                : id >= 200 && id <= 232
                ? (ic_ced = "storm")
                : id >= 600 && id <= 622
                ? (ic_ced = "snow")
                : id >= 701 && id <= 781
                ? (ic_ced = "haze")
                : id >= 801 && id <= 804
                ? (ic_ced = "cloud")
                : id >= 300 && id <= 321 && (ic_ced = "rain")
        let imgsrc = `https://baum21614-cdn.github.io/imges/weather/${ic_ced}.svg`
        document.querySelector(".wepicin").src = imgsrc
    }
    if(!navigator.geolocation.getCurrentPosition()){
        fetch("http://ip-api.com/json/")
        .then((response)=>response.json())
        .then((res)=>{ 
            const userCity = res.city
            fetch(`https://api.openweathermap.org/data/2.5/weather?q=${userCity}&units=metric&appid=9f0be11654b16dc791d8283f8c542b1b`)
                .then((response) => response.json())
                .then((result) => weatherDetails(result));
        })
        return
    }else{
        const handleSuccess = pos =>{
            lat = pos.coords.latitude
            lon = pos.coords.longitude
        }
        const handleError = () =>{
            displayError()
            return
        }
        navigator.geolocation.getCurrentPosition(handleSuccess, handleError)
        fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=9f0be11654b16dc791d8283f8c542b1b`)
            .then((response) => response.json())
            .then((result) => weatherDetails(result));
    }
}
apiPull();
